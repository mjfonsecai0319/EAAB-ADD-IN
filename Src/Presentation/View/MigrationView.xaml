<UserControl
    x:Class="EAABAddIn.Src.Presentation.View.MigrationView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extensions="clr-namespace:ArcGIS.Desktop.Extensions;assembly=ArcGIS.Desktop.Extensions"
    xmlns:controls="clr-namespace:ArcGIS.Desktop.Framework.Controls;assembly=ArcGIS.Desktop.Framework"
    xmlns:viewModel="clr-namespace:EAABAddIn.Src.Presentation.ViewModel"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DataContext="{Binding Path=viewModel.MigrationViewModel}"
    MinWidth="250"
>
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <extensions:DesignOnlyResourceDictionary Source="pack://application:,,,/ArcGIS.Desktop.Framework;component\Themes\Default.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <BooleanToVisibilityConverter x:Key="BoolToVis" />

            <Style x:Key="HeaderTextStyle" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Foreground" Value="{DynamicResource Esri_TextPrimaryBrush}" />
                <Setter Property="Margin" Value="0,0,0,6" />
                <Setter Property="TextWrapping" Value="Wrap" />
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer Margin="10,12,10,12" VerticalScrollBarVisibility="Auto">
        <StackPanel Orientation="Vertical" >
            <TextBlock Text="Migración de datos" Style="{StaticResource HeaderTextStyle}" />

            <!-- Orígenes agrupados -->
            <Expander Header="Acueducto" Margin="0,8,0,0" IsExpanded="True">
                <StackPanel Orientation="Vertical" Margin="10,6,0,6">
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Líneas (origen)"/>
                            <TextBox Text="{Binding L_Acu_Origen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseLAcuOrigenCommand}"/>
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Puntos (origen)"/>
                            <TextBox Text="{Binding P_Acu_Origen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowsePAcuOrigenCommand}"/>
                    </Grid>
                </StackPanel>
            </Expander>

            <Expander Header="Alcantarillado Sanitario" Margin="0,6,0,0" IsExpanded="False">
                <StackPanel Orientation="Vertical" Margin="10,6,0,6">
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Líneas (origen)"/>
                            <TextBox Text="{Binding L_Alc_Origen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseLAlcOrigenCommand}"/>
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Puntos (origen)"/>
                            <TextBox Text="{Binding P_Alc_Origen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowsePAlcOrigenCommand}"/>
                    </Grid>
                </StackPanel>
            </Expander>

            <Expander Header="Alcantarillado Pluvial" Margin="0,6,0,0" IsExpanded="False">
                <StackPanel Orientation="Vertical" Margin="10,6,0,6">
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Líneas (origen)"/>
                            <TextBox Text="{Binding L_Alc_Pluv_Origen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseLAlcPluvOrigenCommand}"/>
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Puntos (origen)"/>
                            <TextBox Text="{Binding P_Alc_Pluv_Origen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowsePAlcPluvOrigenCommand}"/>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- Opcional: Append rápido para pruebas -->
            <Expander Header="Append simple (opcional)" Margin="0,10,0,0" IsExpanded="False">
                <StackPanel Orientation="Vertical" Margin="10,6,0,6">
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Origen (feature class)"/>
                            <TextBox Text="{Binding SourcePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseSourceCommand}"/>
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Destino (feature class)"/>
                            <TextBox Text="{Binding TargetPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseTargetCommand}"/>
                    </Grid>
                    <CheckBox Content="Usar selección del mapa" IsChecked="{Binding UseSelection, Mode=TwoWay}" Margin="0,8,0,0"/>
                </StackPanel>
            </Expander>

            <!-- Salida y opciones -->
            <Expander Header="Salida y esquema" Margin="0,10,0,0" IsExpanded="True">
                <StackPanel Orientation="Vertical" Margin="10,6,0,6">
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="Carpeta de salida (FGDB)"/>
                            <TextBox Text="{Binding OutputFolder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseOutputFolderCommand}"/>
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Vertical" Grid.Column="0">
                            <TextBlock Text="XML de esquema"/>
                            <TextBox Text="{Binding XmlSchemaPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Examinar" Width="80" Margin="6,0,0,0" Command="{Binding BrowseXmlSchemaCommand}"/>
                    </Grid>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <CheckBox Content="Probar esquema (TEST)" IsChecked="{Binding TestSchema, Mode=TwoWay}"/>
                        <CheckBox Content="Migrar con advertencias" IsChecked="{Binding MigrarConAdvertencias, Mode=TwoWay}" Margin="12,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <StackPanel Orientation="Vertical" Margin="0,12,0,0">
                <Button Content="Migrar" Height="34" Command="{Binding RunCommand}"/>
                <TextBlock Text="{Binding StatusMessage}" Margin="0,6,0,0" Foreground="{DynamicResource Esri_TextSecondaryBrush}" TextWrapping="Wrap"/>
                <Button Content="Abrir reportes" Margin="0,6,0,0" Command="{Binding OpenReportsFolderCommand}" Visibility="{Binding HasWarnings, Converter={StaticResource BoolToVis}}" />
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
