<UserControl x:Class="EAABAddIn.Src.Presentation.View.MassiveGeocodeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:extensions="clr-namespace:ArcGIS.Desktop.Extensions;assembly=ArcGIS.Desktop.Extensions"
             xmlns:conv="clr-namespace:EAABAddIn.Src.Presentation.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="450">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <extensions:DesignOnlyResourceDictionary 
                    Source="pack://application:,,,/ArcGIS.Desktop.Framework;component/Themes/Default.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Converters -->
            <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />

            <!-- Estilos adaptativos para tema claro/oscuro -->
            
            <!-- Headers -->
            <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Foreground" Value="{DynamicResource Esri_TextPrimaryBrush}"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
            </Style>

            <!-- Info text -->
            <Style x:Key="InfoTextStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Foreground" Value="{DynamicResource Esri_TextSecondaryBrush}"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
                <Setter Property="LineHeight" Value="16"/>
            </Style>

            <!-- File input container -->
            <Style x:Key="FileInputContainerStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource Esri_BackgroundHoverBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Esri_BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="0,0,0,20"/>
            </Style>

            <!-- TextBox for file path -->
            <Style x:Key="FilePathTextBoxStyle" TargetType="TextBox">
                <Setter Property="Background" Value="{DynamicResource Esri_BackgroundContentBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource Esri_TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Esri_BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="Padding" Value="10,6"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="IsReadOnly" Value="True"/>
                <Style.Triggers>
                    <Trigger Property="IsReadOnly" Value="True">
                        <Setter Property="Background" Value="{DynamicResource Esri_BackgroundHoverBrush}"/>
                        <Setter Property="Foreground" Value="{DynamicResource Esri_TextSecondaryBrush}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Browse button -->
            <Style x:Key="BrowseButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource Esri_BackgroundHoverBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource Esri_TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Esri_BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource Esri_BackgroundPressedBrush}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Process button -->
            <Style x:Key="ProcessButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource Esri_Green}"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Height" Value="36"/>
                <Setter Property="Padding" Value="20,8"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource Esri_GreenHover}"/>
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Background" Value="{DynamicResource Esri_Gray155}"/>
                        <Setter Property="Foreground" Value="{DynamicResource Esri_Gray120}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Progress container -->
            <Style x:Key="ProgressContainerStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource Esri_BackgroundHoverBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Esri_Blue}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="0,0,0,15"/>
            </Style>

            <!-- Status message -->
            <Style x:Key="StatusMessageStyle" TargetType="TextBlock">
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="Foreground" Value="{DynamicResource Esri_TextPrimaryBrush}"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
            </Style>

            <!-- Progress bar -->
            <Style x:Key="ThemedProgressBarStyle" TargetType="ProgressBar">
                <Setter Property="Background" Value="{DynamicResource Esri_BackgroundPressedBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource Esri_Blue}"/>
                <Setter Property="Height" Value="6"/>
            </Style>

            <!-- Instructions container -->
            <Style x:Key="InstructionsContainerStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource Esri_BackgroundHoverBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource Esri_Orange}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="4"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="0,15,0,20"/>
            </Style>

        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />  <!-- Header -->
            <RowDefinition Height="Auto" />  <!-- File input -->
            <RowDefinition Height="Auto" />  <!-- Instructions -->
            <RowDefinition Height="*" />     <!-- Spacer -->
            <RowDefinition Height="Auto" />  <!-- Progress -->
            <RowDefinition Height="Auto" />  <!-- Button -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Geocodificación Masiva" 
                   Style="{StaticResource HeaderTextStyle}"
                   FontSize="16"
                   Margin="0,0,0,15"/>

        <!-- File input section -->
        <Border Grid.Row="1" Style="{StaticResource FileInputContainerStyle}">
            <StackPanel>
                <TextBlock Text="Seleccionar archivo Excel:" 
                          Style="{StaticResource HeaderTextStyle}"
                          Margin="0,0,0,10"/>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="10" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Style="{StaticResource FilePathTextBoxStyle}"
                             Text="{Binding FileInput, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="{Binding FileInput}" />

                    <Button Grid.Column="2"
                            Content="Examinar..."
                            Style="{StaticResource BrowseButtonStyle}"
                            Command="{Binding OpenFileDialogCommand}" />
                </Grid>

                <TextBlock Style="{StaticResource InfoTextStyle}">
                    <Run Text="El archivo debe ser un Excel (.xlsx) con las columnas:"/>
                    <LineBreak/>
                    <Run Text="   • "/>
                    <Run Text="Identificador" FontWeight="Medium"/>
                    <Run Text=" - ID único del registro"/>
                    <LineBreak/>
                    <Run Text="   • "/>
                    <Run Text="Direccion" FontWeight="Medium"/>
                    <Run Text=" - Dirección a geocodificar"/>
                    <LineBreak/>
                    <Run Text="   • "/>
                    <Run Text="Poblacion" FontWeight="Medium"/>
                    <Run Text=" - Nombre de la ciudad o población"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Instructions -->
        <Border Grid.Row="2" Style="{StaticResource InstructionsContainerStyle}">
            <StackPanel>
                <TextBlock Text="Proceso de Geocodificación:" 
                          FontWeight="Bold"
                          FontSize="13"
                          Foreground="{DynamicResource Esri_Orange}"
                          Margin="0,0,0,8"/>
                <TextBlock Style="{StaticResource InfoTextStyle}">
                    <Run Text="1. Seleccione un archivo Excel válido"/>
                    <LineBreak/>
                    <Run Text="2. El sistema validará el formato y las columnas"/>
                    <LineBreak/>
                    <Run Text="3. Se procesarán todas las direcciones automáticamente"/>
                    <LineBreak/>
                    <Run Text="4. Los resultados se mostrarán en el mapa"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Progress section -->
        <Border Grid.Row="4" 
                Style="{StaticResource ProgressContainerStyle}"
                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
                <TextBlock Text="{Binding StatusMessage}"
                          Style="{StaticResource StatusMessageStyle}" />
                <ProgressBar Style="{StaticResource ThemedProgressBarStyle}"
                            IsIndeterminate="True" />
            </StackPanel>
        </Border>

        <!-- Process button -->
        <StackPanel Grid.Row="5" 
                    HorizontalAlignment="Right" 
                    Orientation="Horizontal">
            <Button Content="Procesar Archivo"
                    Style="{StaticResource ProcessButtonStyle}"
                    Command="{Binding SearchCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}" />
        </StackPanel>
    </Grid>
</UserControl>